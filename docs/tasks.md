# TrueNorth – Task Backlog

> **Last Updated:** 2026-02-07  
> **Status Legend:** `[ ]` To Do | `[~]` In Progress | `[x]` Done | `[-]` Blocked

---

## Overview

This backlog is organized into **Phases** (Epics). Each phase builds on the previous one. Tasks within a phase can often be parallelized.

**Estimation Key (T-shirt sizing):**
- **XS:** < 1 hour
- **S:** 1-2 hours
- **M:** 2-4 hours
- **L:** 4-8 hours (half day to full day)
- **XL:** 8+ hours (should be split if possible)

---

## Testing Strategy

### Test Types
- **Unit Tests:** Pure functions, utilities, hooks (Jest + React Native Testing Library)
- **Integration Tests:** API calls, database operations, auth flows
- **Component Tests:** UI components in isolation
- **E2E Tests:** Full user flows (Detox or Maestro)
- **Manual Tests:** Device-specific, UX validation

### Test Tools
| Tool | Purpose |
|------|---------|
| Jest | Unit & integration tests |
| React Native Testing Library | Component testing |
| MSW (Mock Service Worker) | API mocking |
| Maestro | E2E testing (simpler than Detox) |
| Supabase Local | Local database for integration tests |

### Coverage Goals
- **Utilities/Hooks:** 90%+ coverage
- **API Layer:** 80%+ coverage
- **Components:** Key interactions tested
- **E2E:** Critical user paths covered

---

# Phase 0: Project Foundation

> **Goal:** Set up the development environment, initialize the project with all core dependencies, and establish the folder structure.

---

## TASK-001: Initialize Expo Project with TypeScript

**Status:** `[~]` In Progress  
**Estimate:** S  
**Priority:** Critical  
**Dependencies:** None

### Description
Create a new Expo project using the TypeScript blank template. Verify the project runs on iOS Simulator and Expo Go.

### Setup Command
```bash
# This single command creates the entire project structure
npx create-expo-app@latest TrueNorth --template blank-typescript
cd TrueNorth
```

This auto-generates:
- `app.json` - Expo configuration
- `tsconfig.json` - TypeScript settings
- `package.json` - Dependencies
- `App.tsx` - Entry point
- `node_modules/` - All dependencies
- `assets/` - Icon and splash placeholders

### Acceptance Criteria
- [ ] Expo project created with command above
- [ ] Project runs successfully with `npx expo start`
- [ ] App loads in iOS Simulator (press `i` in terminal)
- [ ] App loads in Expo Go on physical iPhone (scan QR code)
- [ ] `app.json` updated with app name "TrueNorth" and slug "truenorth"

### Files to Modify (auto-generated by Expo)
- `app.json` - Update name, slug, scheme
- `tsconfig.json` - Verify strict mode enabled
- `package.json` - Verify scripts

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Project builds | Manual | `npx expo start` runs without errors |
| iOS Simulator | Manual | App opens and shows default screen |
| Expo Go | Manual | QR scan opens app on physical device |
| TypeScript | Manual | Create file with type error, verify IDE shows error |

### Notes
- Run `sudo xcode-select -s /Applications/Xcode.app/Contents/Developer` first if Xcode CLI not configured
- Install Expo Go app on iPhone from App Store before testing

---

## TASK-002: Configure Expo Router for File-Based Navigation

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-001

### Description
Set up expo-router for file-based routing. Create the initial folder structure under `app/` with placeholder screens for all main routes.

### Acceptance Criteria
- [ ] `expo-router` installed and configured in `app.json`
- [ ] Root `_layout.tsx` created with Stack navigator
- [ ] `(tabs)/_layout.tsx` created with bottom tab navigator (4 tabs)
- [ ] Placeholder screens created for all routes:
  - `(auth)/login.tsx`, `(auth)/signup.tsx`
  - `(tabs)/index.tsx` (Today's Bearing)
  - `(tabs)/kanban.tsx`
  - `(tabs)/weekly.tsx`
  - `(tabs)/polaris.tsx`
  - `focus/[id].tsx`
  - `settings/index.tsx`
- [ ] Navigation between tabs works
- [ ] Deep linking tested (e.g., `truenorth://focus/123`)

### Files to Create/Modify
- `app/_layout.tsx`
- `app/(auth)/_layout.tsx`
- `app/(tabs)/_layout.tsx`
- All placeholder screen files

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Tab navigation | Manual | Tap each tab, verify correct screen loads |
| Deep link | Manual | Open `truenorth://kanban` in Safari, verify redirect |
| Back navigation | Manual | Navigate to detail screen, press back, verify return |
| Placeholder screens | Manual | All screens render without crash |

---

## TASK-003: Configure NativeWind (Tailwind CSS)

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-001

### Description
Install and configure NativeWind v4 for Tailwind-style styling in React Native. Set up the design tokens (colors, typography) from the Technical Spec.

### Acceptance Criteria
- [ ] `nativewind` and `tailwindcss` installed
- [ ] `tailwind.config.js` created with custom theme
- [ ] Brand colors configured:
  - `northBlue: #1E2A38`
  - `compassGold: #D4A017`
  - `softMist: #F5F7FA`
  - `success: #2E7D32`
  - Priority colors (1, 2, 3)
- [ ] `global.css` created and imported
- [ ] `babel.config.js` updated for NativeWind
- [ ] Test component renders with Tailwind classes (e.g., `className="bg-northBlue"`)

### Files to Create/Modify
- `tailwind.config.js`
- `global.css`
- `babel.config.js`
- `metro.config.js` (if needed)
- `nativewind-env.d.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Tailwind classes | Manual | `className="bg-northBlue"` renders correct color |
| Brand colors | Manual | All brand colors render correctly |
| Responsive | Manual | Breakpoint classes work (`md:`, `lg:`) |
| Hot reload | Manual | Change className, see update without refresh |

---

## TASK-004: Set Up Project Folder Structure

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** TASK-001

### Description
Create the folder structure for components, lib, constants, types, and assets as defined in the Technical Spec.

### Acceptance Criteria
- [ ] Folder structure created:
  ```
  components/
    ui/
    kanban/
    focus/
    common/
  lib/
    api/
    auth/
    store/
    utils/
  constants/
  types/
  assets/
  ```
- [ ] `constants/colors.ts` created with all brand colors
- [ ] `constants/config.ts` created with app configuration
- [ ] `types/models.ts` created with placeholder interfaces
- [ ] Each folder has an `index.ts` for clean exports

### Files to Create/Modify
- All folders and index files as specified

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Imports work | Manual | `import { colors } from '@/constants'` resolves |
| Path aliases | Manual | `@/` alias works in tsconfig |
| Color values | Unit | `colors.northBlue === '#1E2A38'` |

---

## TASK-005: Install and Configure Core Dependencies

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** Critical  
**Dependencies:** TASK-001

### Description
Install all core npm packages required for the project: state management, data fetching, utilities, and UI libraries.

### Acceptance Criteria
- [ ] State management: `zustand` installed
- [ ] Data fetching: `@tanstack/react-query` installed
- [ ] Supabase: `@supabase/supabase-js`, `react-native-url-polyfill` installed
- [ ] Icons: `lucide-react-native`, `react-native-svg` installed
- [ ] Utilities: `date-fns`, `zod` installed
- [ ] Gestures: `react-native-gesture-handler`, `react-native-reanimated` installed
- [ ] Secure storage: `expo-secure-store` installed
- [ ] All packages compatible with current Expo SDK
- [ ] No peer dependency warnings

### Files to Create/Modify
- `package.json`
- `package-lock.json`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| No peer warnings | Manual | `npm install` shows no peer dependency warnings |
| Imports resolve | Manual | `import { create } from 'zustand'` works |
| App still runs | Manual | `npx expo start` succeeds after install |

---

## TASK-006: Create Supabase Project and Configure Client

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-005

### Description
Create a Supabase project, configure environment variables, and set up the Supabase client for React Native.

### Acceptance Criteria
- [ ] Supabase project created at supabase.com
- [ ] `.env` file created with `EXPO_PUBLIC_SUPABASE_URL` and `EXPO_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `.env.example` created (without secrets)
- [ ] `.gitignore` updated to exclude `.env`
- [ ] `lib/supabase.ts` created with client initialization
- [ ] URL polyfill imported for React Native compatibility
- [ ] Connection test successful (can ping Supabase)

### Files to Create/Modify
- `.env`
- `.env.example`
- `.gitignore`
- `lib/supabase.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Connection test | Integration | `supabase.auth.getSession()` returns (even if null) |
| Env vars loaded | Manual | `console.log(process.env.EXPO_PUBLIC_SUPABASE_URL)` shows URL |
| .env not in git | Manual | `git status` does not show `.env` file |

---

## TASK-007: Create Database Schema in Supabase

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** Critical  
**Dependencies:** TASK-006

### Description
Create all database tables in Supabase using SQL migrations. Enable Row Level Security on all tables.

### Acceptance Criteria
- [ ] Tables created:
  - `north_stars` (life areas)
  - `polaris_goals` (quarterly goals)
  - `monthly_missions`
  - `weekly_headings`
  - `steps` (tasks)
  - `focus_sessions`
- [ ] All foreign key relationships established
- [ ] Row Level Security (RLS) enabled on all tables
- [ ] RLS policies created: users can only access own data
- [ ] `updated_at` trigger created for all tables
- [ ] Schema matches Technical Spec exactly
- [ ] SQL migration files saved in `supabase/migrations/`

### Files to Create/Modify
- `supabase/migrations/001_initial_schema.sql`
- `types/database.ts` (generated or manual)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Tables exist | Integration | Query each table in Supabase dashboard |
| RLS enabled | Integration | Query without auth token returns empty |
| RLS allows own data | Integration | Insert row, query returns it |
| Foreign keys | Integration | Insert step with invalid north_star_id fails |
| Types generated | Manual | `types/database.ts` has all table types |

---

## TASK-008: Configure React Query with Offline Persistence

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-005, TASK-006

### Description
Set up React Query (TanStack Query) with a QueryClient. Configure persistence for offline support using AsyncStorage.

### Acceptance Criteria
- [ ] `QueryClientProvider` wrapping app in root layout
- [ ] Default query options configured:
  - `staleTime`: 5 minutes
  - `gcTime`: 24 hours
  - `retry`: 3
- [ ] Offline persistence configured with `@tanstack/query-async-storage-persister`
- [ ] Queries persist across app restarts
- [ ] Network status detection (online/offline indicator)

### Files to Create/Modify
- `lib/api/queryClient.ts`
- `app/_layout.tsx` (add provider)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Provider wraps app | Manual | App renders without QueryClient errors |
| Cache persists | Manual | Fetch data, kill app, reopen, data still there |
| Stale time works | Integration | Data refetches after stale time expires |
| Offline mode | Manual | Turn off WiFi, cached data still displays |

---

## TASK-008B: Set Up Testing Infrastructure

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-005

### Description
Set up Jest, React Native Testing Library, and MSW for unit, integration, and component testing.

### Acceptance Criteria
- [ ] Jest configured for React Native
- [ ] React Native Testing Library installed
- [ ] MSW (Mock Service Worker) configured for API mocking
- [ ] Sample test passes (`npm test`)
- [ ] Test scripts in `package.json`
- [ ] Coverage reporting enabled
- [ ] CI-friendly test runner (exit codes)

### Setup Commands
```bash
npm install --save-dev jest @testing-library/react-native @testing-library/jest-native
npm install --save-dev msw
npm install --save-dev @types/jest
```

### Files to Create/Modify
- `jest.config.js`
- `jest.setup.js`
- `__tests__/example.test.ts` (sample test)
- `mocks/handlers.ts` (MSW handlers)
- `package.json` (test scripts)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Jest runs | Manual | `npm test` executes without errors |
| Sample passes | Unit | Example test returns green |
| Coverage | Manual | Coverage report generated |
| MSW mocks | Unit | API call returns mocked data |

---

## TASK-009: Set Up Zustand Stores for UI State

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** TASK-005

### Description
Create Zustand stores for local UI state that doesn't need to be persisted to the server.

### Acceptance Criteria
- [ ] `lib/store/uiStore.ts` created with:
  - Current Kanban filter (all/by tag)
  - Selected date for viewing
  - Modal states (open/closed)
  - Focus mode active state
- [ ] `lib/store/index.ts` exports all stores
- [ ] Stores are typed with TypeScript
- [ ] Test: UI state persists during navigation

### Files to Create/Modify
- `lib/store/uiStore.ts`
- `lib/store/index.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Store updates | Unit | `setFilter()` updates state correctly |
| State persists | Manual | Change filter, navigate away, return, filter preserved |
| TypeScript types | Manual | IDE shows correct types for store values |

---

# Phase 1: Authentication

## Phase 1 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Auth service | Unit | signUp, signIn, signOut functions |
| Auth hooks | Integration | useAuth hook with Supabase |
| Login flow | E2E | Email login, error handling |
| Social auth | Manual | Apple/Google sign-in on device |
| Session persistence | Integration | Token storage and refresh |

> **Goal:** Implement user authentication with Apple Sign-In, Google Sign-In, and email/password.

---

## TASK-010: Create Auth Layout and Navigation Guard

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-002, TASK-006

### Description
Create the authentication layout and implement navigation guards to redirect unauthenticated users to login.

### Acceptance Criteria
- [ ] `(auth)/_layout.tsx` created with Stack navigator
- [ ] Auth state listener set up (`onAuthStateChange`)
- [ ] Unauthenticated users redirected to `/login`
- [ ] Authenticated users redirected to `/(tabs)`
- [ ] Loading state shown while checking auth
- [ ] Session persisted in secure storage

### Files to Create/Modify
- `app/(auth)/_layout.tsx`
- `app/_layout.tsx`
- `lib/auth/useAuth.ts` (hook)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Redirect unauth | E2E | Open app without session, lands on login |
| Redirect auth | E2E | Open app with session, lands on tabs |
| Loading state | Manual | Spinner shows while checking auth |
| Session listener | Integration | Sign out in Supabase dashboard, app redirects |

---

## TASK-011: Build Login Screen UI

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-003, TASK-010

### Description
Design and build the login screen with email/password form and social login buttons.

### Acceptance Criteria
- [ ] Login screen matches brand design (northBlue, compassGold accents)
- [ ] TrueNorth logo/title displayed
- [ ] Email input field with validation
- [ ] Password input field with show/hide toggle
- [ ] "Log In" button (disabled until valid input)
- [ ] "Sign in with Apple" button (styled per Apple guidelines)
- [ ] "Sign in with Google" button
- [ ] "Forgot password?" link
- [ ] "Don't have an account? Sign up" link
- [ ] Loading state on submit
- [ ] Error messages displayed clearly

### Files to Create/Modify
- `app/(auth)/login.tsx`
- `components/ui/Input.tsx`
- `components/ui/Button.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| UI renders | Component | Login screen renders all elements |
| Email validation | Component | Invalid email shows error |
| Button disabled | Component | Button disabled until valid input |
| Password toggle | Manual | Show/hide password works |
| Brand styling | Manual | Colors match design spec |

---

## TASK-012: Build Signup Screen UI

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-011

### Description
Design and build the signup screen with email/password registration.

### Acceptance Criteria
- [ ] Signup screen consistent with login design
- [ ] Email input with validation (valid email format)
- [ ] Password input with strength requirements shown
- [ ] Confirm password input with match validation
- [ ] "Create Account" button
- [ ] Terms of Service and Privacy Policy links
- [ ] "Already have an account? Log in" link
- [ ] Success state: "Check your email to confirm"

### Files to Create/Modify
- `app/(auth)/signup.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| UI renders | Component | Signup screen renders all elements |
| Password match | Component | Mismatch passwords shows error |
| Password strength | Component | Weak password shows requirements |
| Success state | Manual | "Check your email" message appears |
| Terms links | Manual | Links open in browser |

---

## TASK-013: Implement Email/Password Authentication

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-011, TASK-012

### Description
Connect login and signup forms to Supabase Auth for email/password authentication.

### Acceptance Criteria
- [ ] `signUp` function calls `supabase.auth.signUp()`
- [ ] `signIn` function calls `supabase.auth.signInWithPassword()`
- [ ] `signOut` function calls `supabase.auth.signOut()`
- [ ] Email confirmation flow works
- [ ] Error handling for:
  - Invalid credentials
  - Email already registered
  - Weak password
  - Network errors
- [ ] Session stored in secure storage
- [ ] Auto-login on app restart if session valid

### Files to Create/Modify
- `lib/auth/authService.ts`
- `lib/auth/useAuth.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| signUp success | Integration | New user created in Supabase |
| signUp duplicate | Integration | "Email already registered" error |
| signIn success | Integration | Valid credentials return session |
| signIn invalid | Integration | Invalid credentials show error |
| signOut | Integration | Session cleared, user redirected |
| Session persist | Integration | Kill app, reopen, still logged in |
| Token refresh | Integration | Expired token auto-refreshes |

---

## TASK-014: Implement Apple Sign-In

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** Critical  
**Dependencies:** TASK-013

### Description
Implement Apple Sign-In using Supabase Auth. This is required for App Store if any social login is offered.

### Acceptance Criteria
- [ ] `expo-apple-authentication` installed
- [ ] Apple Sign-In button functional
- [ ] Supabase configured for Apple provider
- [ ] User created/linked on first Apple sign-in
- [ ] Name and email captured (if user allows)
- [ ] Works on iOS 13+
- [ ] Graceful fallback on unsupported devices

### Files to Create/Modify
- `lib/auth/appleAuth.ts`
- `app/(auth)/login.tsx` (connect button)
- `app.json` (add Apple entitlements)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Button renders | Component | Apple button visible on login screen |
| Sign in flow | Manual | Tap button, Apple sheet appears |
| New user | Manual | First sign-in creates account |
| Returning user | Manual | Second sign-in logs in existing account |
| Cancel flow | Manual | User cancels, no error shown |
| Unsupported device | Manual | Graceful fallback on iOS < 13 |

### Notes
- Requires Apple Developer account configuration
- Test on real device (Simulator has limitations)

---

## TASK-015: Implement Google Sign-In

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** High  
**Dependencies:** TASK-013

### Description
Implement Google Sign-In using Supabase Auth.

### Acceptance Criteria
- [ ] `expo-auth-session` and `expo-web-browser` installed
- [ ] Google OAuth configured in Supabase
- [ ] Google Cloud Console OAuth credentials created
- [ ] Google Sign-In button functional
- [ ] User created/linked on first Google sign-in
- [ ] Profile picture URL captured

### Files to Create/Modify
- `lib/auth/googleAuth.ts`
- `app/(auth)/login.tsx` (connect button)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Button renders | Component | Google button visible on login screen |
| Sign in flow | Manual | Tap button, Google OAuth opens |
| New user | Manual | First sign-in creates account |
| Returning user | Manual | Second sign-in logs in existing account |
| Cancel flow | Manual | User cancels, no error shown |

---

## TASK-016: Build Forgot Password Flow

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** Medium  
**Dependencies:** TASK-013

### Description
Implement password reset flow with email link.

### Acceptance Criteria
- [ ] Forgot password screen with email input
- [ ] "Send Reset Link" button
- [ ] Success message: "Check your email"
- [ ] Reset link opens app (deep link)
- [ ] Password reset form (new password + confirm)
- [ ] Success → redirect to login

### Files to Create/Modify
- `app/(auth)/forgot-password.tsx`
- `app/(auth)/reset-password.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Request reset | Integration | Email sent to valid address |
| Invalid email | Integration | Appropriate error message |
| Reset link | Manual | Click email link, opens app |
| Password update | Integration | New password works for login |
| Weak password | Component | Validation error shown |

---

# Phase 2: Onboarding

## Phase 2 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Onboarding flow | E2E | Full first-time user journey |
| North Star CRUD | Integration | Create, read, update via API |
| Polaris Goal create | Integration | Create first goal via API |
| Skip logic | Manual | Verify onboarding flag set correctly |

> **Goal:** Create first-time user experience to set up North Stars and initial goal.

---

## TASK-017: Create Onboarding Layout and Flow

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-010

### Description
Create the onboarding flow layout with progress indicator and navigation between steps.

### Acceptance Criteria
- [ ] `onboarding/_layout.tsx` created
- [ ] Progress indicator (dots or bar) showing current step
- [ ] Back/Next navigation
- [ ] Skip option (where appropriate)
- [ ] Onboarding state tracked (show only for new users)
- [ ] User flag `has_completed_onboarding` stored

### Files to Create/Modify
- `app/onboarding/_layout.tsx`
- `app/onboarding/index.tsx` (redirect logic)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| New user redirect | E2E | New user goes to onboarding after signup |
| Returning user skip | E2E | Returning user skips onboarding |
| Progress indicator | Manual | Dots update as user progresses |
| Back navigation | Manual | Back button goes to previous step |
| Flag persistence | Integration | `has_completed_onboarding` saved |

---

## TASK-018: Build Welcome Screen

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** TASK-017

### Description
Create the welcome screen introducing TrueNorth's philosophy.

### Acceptance Criteria
- [ ] TrueNorth logo/icon displayed
- [ ] Welcome headline: "Find Your Direction"
- [ ] Brief value proposition (2-3 sentences)
- [ ] "Get Started" button
- [ ] Calm, minimal design matching brand

### Files to Create/Modify
- `app/onboarding/welcome.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| UI renders | Component | Logo, headline, button visible |
| Get Started | Manual | Button navigates to next step |
| Styling | Manual | Matches brand (calm, minimal) |

---

## TASK-019: Build North Stars Setup Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-017, TASK-007

### Description
Create screen for users to define their North Stars (life areas).

### Acceptance Criteria
- [ ] Explanation of what North Stars are
- [ ] Suggested defaults: Work, Family, Health, Learning
- [ ] User can add custom North Stars
- [ ] User can remove/rename defaults
- [ ] Max 6 North Stars enforced
- [ ] Each North Star can have a color and icon
- [ ] "Continue" saves to database
- [ ] Minimum 1 North Star required

### Files to Create/Modify
- `app/onboarding/north-stars.tsx`
- `lib/api/northStars.ts` (React Query mutations)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Default suggestions | Component | Work, Family, Health, Learning shown |
| Add custom | Manual | User can add custom North Star |
| Remove | Manual | User can remove North Star |
| Max 6 enforced | Component | Can't add 7th North Star |
| Min 1 enforced | Component | Can't continue with 0 |
| Saved to DB | Integration | North Stars appear in Supabase |

---

## TASK-020: Build First Goal Setup Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-019

### Description
Guide user to create their first Polaris Goal (quarterly goal).

### Acceptance Criteria
- [ ] Explanation of Polaris Goals
- [ ] User selects which North Star this goal belongs to
- [ ] Text input for goal title
- [ ] Current quarter pre-selected
- [ ] Example goals shown for inspiration
- [ ] "Finish Setup" saves goal and completes onboarding
- [ ] Redirect to main app (Today's Bearing)

### Files to Create/Modify
- `app/onboarding/first-goal.tsx`
- `lib/api/polarisGoals.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| North Star picker | Component | Shows user's North Stars |
| Quarter pre-selected | Component | Current quarter selected by default |
| Goal saved | Integration | Goal appears in Supabase |
| Onboarding complete | E2E | Redirects to main app after finish |
| Flag set | Integration | `has_completed_onboarding = true` |

---

# Phase 3: Goals Hierarchy (Polaris)

## Phase 3 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| North Star CRUD | Integration | Create, read, update, delete |
| Polaris Goal CRUD | Integration | Create, read, update, delete |
| Monthly Mission CRUD | Integration | Create, read, update, delete |
| Weekly Heading CRUD | Integration | Create, read, update, delete |
| Hierarchy navigation | E2E | Drill-down from North Star to Mission |
| Data relationships | Integration | Foreign key constraints work |

> **Goal:** Build the full goals management system: North Stars, Polaris Goals, Monthly Missions, Weekly Headings.

---

## TASK-021: Build Polaris Main Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-002, TASK-007, TASK-008

### Description
Create the main Polaris tab showing the goals hierarchy overview.

### Acceptance Criteria
- [ ] Screen title: "Polaris"
- [ ] List of North Stars displayed as cards
- [ ] Each North Star shows:
  - Name and icon
  - Count of active Polaris Goals
  - Color accent
- [ ] Tap North Star → drill down to its goals
- [ ] "Add North Star" button (if < 6)
- [ ] Empty state if no North Stars

### Files to Create/Modify
- `app/(tabs)/polaris.tsx`
- `components/polaris/NorthStarCard.tsx`
- `lib/api/northStars.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| List renders | Component | North Stars display as cards |
| Goal count | Component | Each card shows correct goal count |
| Tap drills down | Manual | Tap opens North Star detail |
| Add button | Component | Add button visible if < 6 |
| Empty state | Component | Helpful message if no North Stars |
| Pull refresh | Manual | Pulls latest data from server |

---

## TASK-022: Build North Star Detail Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-021

### Description
Create drill-down screen showing a North Star's Polaris Goals and options.

### Acceptance Criteria
- [ ] Header with North Star name, color, icon
- [ ] Edit button (name, color, icon)
- [ ] Delete button (with confirmation)
- [ ] List of Polaris Goals for this North Star
- [ ] Each goal shows: title, quarter/year, active status
- [ ] "Add Polaris Goal" button
- [ ] Tap goal → drill down to Monthly Missions

### Files to Create/Modify
- `app/polaris/[northStarId].tsx`
- `components/polaris/PolarisGoalCard.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Header shows name | Component | North Star name in header |
| Goals list | Component | Polaris Goals for this NS shown |
| Edit North Star | Manual | Can change name, color, icon |
| Delete North Star | Manual | Confirmation dialog, then delete |
| Add goal button | Component | "Add Polaris Goal" visible |
| Goal tap | Manual | Opens goal detail |

---

## TASK-023: Build Polaris Goal CRUD Operations

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-022

### Description
Implement create, read, update, delete for Polaris Goals.

### Acceptance Criteria
- [ ] Create modal/screen with:
  - Title input
  - Quarter picker (Q1-Q4)
  - Year picker
  - North Star selector (pre-filled if from drill-down)
- [ ] Edit functionality (same form, pre-filled)
- [ ] Delete with confirmation dialog
- [ ] Optimistic updates (UI updates before server confirms)
- [ ] Error handling with rollback

### Files to Create/Modify
- `app/polaris/goal/new.tsx`
- `app/polaris/goal/[goalId].tsx`
- `lib/api/polarisGoals.ts` (React Query hooks)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Create goal | Integration | New goal saved to database |
| Edit goal | Integration | Changes persisted |
| Delete goal | Integration | Goal removed from database |
| Optimistic update | Manual | UI updates before server confirms |
| Rollback on error | Integration | UI reverts if server fails |
| Form validation | Component | Title required |

---

## TASK-024: Build Monthly Missions Management

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-023

### Description
Implement Monthly Missions CRUD and display within goal drill-down.

### Acceptance Criteria
- [ ] Monthly Missions list under each Polaris Goal
- [ ] Create mission modal with:
  - Title input
  - Month picker
  - Linked Polaris Goal (pre-filled)
- [ ] Edit and delete functionality
- [ ] Current month's mission highlighted
- [ ] Visual connection between mission and goal

### Files to Create/Modify
- `app/polaris/mission/new.tsx`
- `components/polaris/MonthlyMissionCard.tsx`
- `lib/api/monthlyMissions.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Create mission | Integration | New mission saved to database |
| Linked to goal | Integration | `polaris_goal_id` set correctly |
| Current month highlight | Component | Current month's mission styled differently |
| Edit mission | Integration | Changes persisted |
| Delete mission | Integration | Mission removed |

---

## TASK-025: Build Weekly Headings Management

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-024

### Description
Implement Weekly Headings as part of the weekly planning flow.

### Acceptance Criteria
- [ ] Weekly Headings section in Weekly Planning screen
- [ ] Create heading with title and week start date
- [ ] Max 3 headings per week enforced
- [ ] Edit and delete functionality
- [ ] Current week's headings highlighted
- [ ] Headings accessible from Polaris screen as well

### Files to Create/Modify
- `lib/api/weeklyHeadings.ts`
- `components/weekly/WeeklyHeadingCard.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Create heading | Integration | New heading saved to database |
| Max 3 enforced | Component | Can't add 4th heading for same week |
| Edit heading | Integration | Changes persisted |
| Delete heading | Integration | Heading removed |
| Current week highlight | Component | This week's headings styled differently |

---

# Phase 4: Personal Kanban

## Phase 4 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Kanban board | Component | Layout, columns, scroll |
| Step CRUD | Integration | Create, read, update, delete steps |
| Drag and drop | E2E | Move between columns |
| Priority rules | Unit | One P1 per day validation |
| Filters | Component | Filter by North Star |

> **Goal:** Build the core Kanban board for task management.

---

## TASK-026: Build Kanban Board Layout

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** Critical  
**Dependencies:** TASK-002, TASK-003, TASK-008

### Description
Create the horizontal scrolling Kanban board with four columns.

### Acceptance Criteria
- [ ] Horizontal scroll view with 4 columns:
  - Horizon (inbox)
  - This Week
  - Today
  - Done
- [ ] Each column has header with name and count
- [ ] Columns are scrollable vertically if many items
- [ ] Soft visual indication when column is "full":
  - Horizon: no limit
  - This Week: >7 tasks shows warning
  - Today: >5 tasks shows warning
- [ ] Current day indicated in Today column header

### Files to Create/Modify
- `app/(tabs)/kanban.tsx`
- `components/kanban/KanbanBoard.tsx`
- `components/kanban/KanbanColumn.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Four columns | Component | Horizon, This Week, Today, Done visible |
| Horizontal scroll | Manual | Can scroll between columns |
| Vertical scroll | Manual | Long column scrolls vertically |
| Column counts | Component | Task counts update correctly |
| Soft limits | Component | Warning shown when >7 in This Week |
| Date in Today header | Component | Shows current date |

---

## TASK-027: Build Step Card Component

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-026

### Description
Create the task card component displayed in Kanban columns.

### Acceptance Criteria
- [ ] Card displays:
  - Title
  - Priority badge (P1 red, P2 amber, P3 gray)
  - Max time (e.g., "45 min")
  - Linked North Star color dot
  - Tag if assigned
- [ ] P1 card has special styling (True Step)
- [ ] Tap card → open detail/edit modal
- [ ] Long press → drag mode
- [ ] Completed cards in Done column show checkmark

### Files to Create/Modify
- `components/kanban/StepCard.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Title displayed | Component | Task title visible |
| Priority badge | Component | P1 red, P2 amber, P3 gray |
| Time displayed | Component | "45 min" shown |
| North Star dot | Component | Correct color for linked NS |
| P1 styling | Component | True Step has special border/style |
| Tap opens modal | Manual | Opens edit modal |
| Checkmark in Done | Component | Completed tasks show checkmark |

---

## TASK-028: Implement Drag and Drop Between Columns

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** High  
**Dependencies:** TASK-026, TASK-027

### Description
Enable drag-and-drop functionality to move tasks between Kanban columns.

### Acceptance Criteria
- [ ] Long press initiates drag
- [ ] Visual feedback during drag (card lifted, shadow)
- [ ] Drop zones highlighted when dragging
- [ ] Reorder within column supported
- [ ] Move between columns supported
- [ ] Animation smooth (60fps)
- [ ] Haptic feedback on drop
- [ ] Updates persisted to database

### Files to Create/Modify
- `components/kanban/DraggableStepCard.tsx`
- `lib/api/steps.ts` (update column mutation)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Long press drag | Manual | Long press lifts card |
| Visual feedback | Manual | Shadow/lift effect visible |
| Drop zones | Manual | Columns highlight on drag over |
| Reorder within | Manual | Can reorder within same column |
| Move between | Manual | Can move to different column |
| Animation smooth | Manual | 60fps, no jank |
| Haptic on drop | Manual | Feel haptic feedback |
| Persisted | Integration | Database updated on drop |

### Notes
- Consider using `react-native-draggable-flatlist` or custom solution with reanimated

---

## TASK-029: Build Step Create/Edit Modal

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-027

### Description
Create modal for adding and editing Steps (tasks).

### Acceptance Criteria
- [ ] Modal slides up from bottom
- [ ] Fields:
  - Title (required)
  - Priority selector (1/2/3, default 3)
  - Max time picker (15/30/45/60/90/120 min)
  - Column selector (defaults to Horizon)
  - North Star selector (optional)
  - Polaris Goal selector (optional, filtered by North Star)
  - Scheduled date (optional, for Today column)
- [ ] Validation: title required
- [ ] Save button creates/updates step
- [ ] Delete button (edit mode only) with confirmation
- [ ] Quick add: just title, everything else defaults

### Files to Create/Modify
- `components/kanban/StepModal.tsx`
- `lib/api/steps.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Modal opens | Manual | Slides up from bottom |
| Create step | Integration | New step saved to database |
| Edit step | Integration | Changes persisted |
| Delete step | Integration | Step removed with confirmation |
| Validation | Component | Title required to save |
| Priority default | Component | P3 selected by default |
| Column default | Component | Horizon selected by default |
| Quick add | Manual | Just title creates step quickly |

---

## TASK-030: Implement Step Priority Rules

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** TASK-029

### Description
Enforce the "one P1 per day" rule and priority-based sorting.

### Acceptance Criteria
- [ ] Only 1 Priority-1 task allowed in Today column
- [ ] If user tries to add second P1 to Today:
  - Show dialog: "You already have a True Step. Replace it?"
  - Option to demote existing P1 to P2
- [ ] Tasks sorted within column: P1 → P2 → P3
- [ ] P1 in Today column styled as "True Step"

### Files to Create/Modify
- `lib/api/steps.ts` (validation)
- `components/kanban/StepModal.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| One P1 allowed | Unit | `validateSingleP1()` returns error for second P1 |
| Dialog shown | Manual | "Replace True Step?" dialog appears |
| Demote option | Manual | Can demote existing P1 to P2 |
| Sorting | Component | P1 appears first in column |
| P1 styling | Component | True Step styled prominently |

---

## TASK-031: Build Kanban Filters and Quick Add

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Medium  
**Dependencies:** TASK-026, TASK-029

### Description
Add filtering options and quick-add functionality to Kanban.

### Acceptance Criteria
- [ ] Filter by North Star (show tasks for one life area)
- [ ] Filter chips displayed at top
- [ ] "All" filter to reset
- [ ] Quick add button (floating action button or header button)
- [ ] Quick add: tap → enter title → submit → added to Horizon
- [ ] Filter state persists during session

### Files to Create/Modify
- `components/kanban/KanbanFilters.tsx`
- `components/kanban/QuickAddStep.tsx`
- `lib/store/uiStore.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Filter chips | Component | All, Work, Family etc. shown |
| Filter works | Manual | Only matching tasks shown |
| All resets | Manual | "All" shows all tasks |
| Quick add | Manual | FAB opens quick add input |
| Quick add creates | Integration | Step added to Horizon |
| Filter persists | Manual | Navigate away, return, filter still set |

---

# Phase 5: Today's Bearing (Home)

## Phase 5 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Today's Bearing | Component | Layout, True Step, task list |
| True Step display | Component | P1 styling, completion |
| Task list | Component | P2/P3 display, swipe to complete |
| Morning rule | Unit | Time detection logic |
| Focus entry | E2E | Start Focus from home screen |

> **Goal:** Build the home screen showing today's tasks with the True Step highlighted.

---

## TASK-032: Build Today's Bearing Layout

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-008

### Description
Create the home screen layout following the PRD design.

### Acceptance Criteria
- [ ] Screen title: Today's date (e.g., "Saturday, February 7")
- [ ] Calm, minimal design
- [ ] Three sections:
  1. True Step (P1) - prominent display
  2. Today's Tasks (P2, P3)
  3. Entry point to Focus Mode
- [ ] Pull-to-refresh updates data
- [ ] Empty state if no tasks planned

### Files to Create/Modify
- `app/(tabs)/index.tsx`
- `components/today/TodayBearing.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Date displayed | Component | Current date formatted correctly |
| True Step section | Component | P1 task displayed prominently |
| Other tasks section | Component | P2/P3 tasks listed below |
| Pull refresh | Manual | Refreshes data from server |
| Empty state | Component | Helpful message if no tasks |
| Calm design | Manual | Matches brand aesthetic |

---

## TASK-033: Build True Step Display Component

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Critical  
**Dependencies:** TASK-032

### Description
Create the prominent True Step card for the home screen.

### Acceptance Criteria
- [ ] Large card with P1 task title
- [ ] Linked North Star shown
- [ ] Max time displayed
- [ ] "Start Focus" button
- [ ] Encouraging microcopy (e.g., "Your one thing today")
- [ ] Completed state: checkmark, strikethrough, celebration
- [ ] Empty state: "No True Step planned" with calm messaging

### Files to Create/Modify
- `components/today/TrueStepCard.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Title displayed | Component | P1 task title visible |
| North Star | Component | Linked North Star shown |
| Max time | Component | Duration displayed |
| Start Focus | Manual | Button navigates to Focus Mode |
| Completed state | Component | Checkmark, strikethrough shown |
| Celebration | Manual | Animation plays on completion |
| Empty state | Component | Calm "No True Step" message |
| Microcopy | Manual | Encouraging text present |

---

## TASK-034: Build Today's Tasks List

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-032

### Description
Display P2 and P3 tasks scheduled for today.

### Acceptance Criteria
- [ ] List of P2 and P3 tasks below True Step
- [ ] Each task shows: title, priority, max time
- [ ] Tap task → open detail modal
- [ ] Swipe to complete (moves to Done)
- [ ] Completed tasks show briefly then animate out
- [ ] Count of remaining tasks

### Files to Create/Modify
- `components/today/TodayTasksList.tsx`
- `components/today/TodayTaskItem.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| P2/P3 displayed | Component | Only P2 and P3 tasks shown |
| Task info | Component | Title, priority, time visible |
| Tap opens modal | Manual | Opens task detail |
| Swipe complete | Manual | Swipe moves to Done |
| Animation out | Manual | Completed task animates away |
| Count shown | Component | Remaining task count displayed |

---

## TASK-035: Implement Morning-Only Rule UI

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** Medium  
**Dependencies:** TASK-032

### Description
Reinforce the "no planning in the morning" philosophy in the UI.

### Acceptance Criteria
- [ ] No "Add Task" button on Today's Bearing
- [ ] If user tries to add task via long-press: show gentle reminder
  - "Plan in the evening, execute in the morning"
  - Link to Kanban for adding tasks
- [ ] Time-based detection (morning = 5am-12pm)
- [ ] Can be bypassed if user insists

### Files to Create/Modify
- `components/today/MorningGuard.tsx`
- `lib/utils/timeUtils.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Morning detection | Unit | `isMorning()` returns true 5am-12pm |
| No add button | Component | No "Add Task" in morning |
| Gentle reminder | Manual | Long-press shows philosophy message |
| Link to Kanban | Manual | Reminder links to Kanban |
| Bypass option | Manual | User can bypass if they insist |
| Evening allowed | Manual | After 12pm, adding works normally |

---

# Phase 6: Focus Mode

## Phase 6 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Timer logic | Unit | Countdown, pause, resume |
| Background handling | Integration | Timer accurate after background |
| Focus session | Integration | Session saved to database |
| Completion flow | E2E | Complete task via Focus Mode |

> **Goal:** Build the full-screen focus timer for deep work.

---

## TASK-036: Build Focus Mode Screen

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** High  
**Dependencies:** TASK-027

### Description
Create the full-screen Focus Mode with countdown timer.

### Acceptance Criteria
- [ ] Full-screen display (status bar hidden optional)
- [ ] Minimal UI: task title, timer, controls
- [ ] Large countdown timer (MM:SS format)
- [ ] Timer starts at task's max time
- [ ] Controls: Pause / Resume / Complete
- [ ] Timer continues if app backgrounded
- [ ] Visual indicator of time passing (progress ring or similar)

### Files to Create/Modify
- `app/focus/[id].tsx`
- `components/focus/FocusTimer.tsx`
- `components/focus/FocusControls.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Full screen | Manual | Status bar hidden, minimal UI |
| Task title | Component | Task name displayed |
| Timer displays | Component | MM:SS countdown format |
| Timer starts | Manual | Begins at task's max time |
| Pause works | Manual | Timer pauses, button changes |
| Resume works | Manual | Timer resumes from pause |
| Complete works | Manual | Marks task done, exits |
| Progress visual | Manual | Ring/bar shows time remaining |

---

## TASK-037: Implement Timer Logic and Background Handling

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-036

### Description
Implement robust timer logic that works when app is backgrounded.

### Acceptance Criteria
- [ ] Timer counts down accurately
- [ ] Timer continues when app is backgrounded
- [ ] Returning to app shows correct remaining time
- [ ] Timer completion triggers notification (if backgrounded)
- [ ] Pause persists app state
- [ ] Handle edge cases: midnight rollover, timezone

### Files to Create/Modify
- `lib/utils/timer.ts`
- `components/focus/FocusTimer.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Accurate countdown | Unit | Timer loses 1 second per second |
| Background continue | Manual | Background app, return, timer correct |
| Notification on complete | Manual | Notification fires when backgrounded |
| Pause persists | Manual | Pause, background, return, still paused |
| Midnight handling | Unit | Timer works across midnight |
| Timezone handling | Unit | Timer unaffected by TZ changes |

---

## TASK-038: Build Focus Session Completion Flow

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-036

### Description
Handle focus session completion, early completion, and abandonment.

### Acceptance Criteria
- [ ] "Complete" button marks task as done
- [ ] Focus session record saved to database:
  - Start time
  - End time
  - Duration
  - Completed (yes/no)
- [ ] Celebration animation on completion
- [ ] Back button shows confirmation: "End focus session?"
- [ ] Option to mark task done even if time remaining
- [ ] Navigation back to Today's Bearing on complete

### Files to Create/Modify
- `lib/api/focusSessions.ts`
- `components/focus/CompletionCelebration.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Complete marks done | Integration | Step moved to Done column |
| Session recorded | Integration | Focus session saved with times |
| Duration accurate | Integration | `duration_seconds` matches actual |
| Celebration plays | Manual | Animation shown on complete |
| Early complete | Manual | Can complete before timer ends |
| Back confirms | Manual | "End session?" dialog on back |
| Navigates home | Manual | Returns to Today's Bearing |

---

## TASK-039: Add Focus Mode Haptics and Sound

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** Low  
**Dependencies:** TASK-036

### Description
Add sensory feedback to Focus Mode for better experience.

### Acceptance Criteria
- [ ] Haptic feedback on:
  - Start
  - Pause/Resume
  - Complete
  - Timer reaching 0
- [ ] Optional completion sound
- [ ] Settings to enable/disable sounds
- [ ] Respects device silent mode

### Files to Create/Modify
- `lib/utils/haptics.ts`
- Settings integration

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Haptic on start | Manual | Feel feedback on session start |
| Haptic on pause | Manual | Feel feedback on pause/resume |
| Haptic on complete | Manual | Feel feedback on completion |
| Haptic on timer end | Manual | Feel feedback at 0:00 |
| Sound plays | Manual | Sound on completion (if enabled) |
| Settings toggle | Manual | Can enable/disable in settings |
| Silent mode | Manual | No sound when phone on silent |

---

# Phase 7: Weekly Planning

## Phase 7 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Weekly screen | Component | Layout, sections, week selector |
| Weekly review | Integration | Save/load review answers |
| Weekly headings | Integration | Create, limit to 3 |
| Populate week | Integration | Move tasks to This Week |

> **Goal:** Build the weekly review and planning workflow.

---

## TASK-040: Build Weekly Planning Screen Layout

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-002, TASK-025

### Description
Create the weekly planning screen with review and setup sections.

### Acceptance Criteria
- [ ] Screen title: "Weekly Planning" with current week range
- [ ] Two main sections:
  1. Weekly Review (reflection prompts)
  2. This Week Setup (headings + tasks)
- [ ] Week selector (previous/next week)
- [ ] Current week is default
- [ ] Completion indicator (review done, headings set)

### Files to Create/Modify
- `app/(tabs)/weekly.tsx`
- `components/weekly/WeeklyPlanning.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Week range | Component | Shows Mon-Sun date range |
| Two sections | Component | Review and Setup sections visible |
| Week selector | Manual | Previous/next week navigation |
| Current week default | Component | Opens to current week |
| Completion indicator | Component | Shows what's done |

---

## TASK-041: Build Weekly Review Component

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-040

### Description
Create guided weekly review with reflection prompts.

### Acceptance Criteria
- [ ] Three reflection prompts:
  - "What moved me forward this week?"
  - "What drifted or got stuck?"
  - "What needs adjustment?"
- [ ] Text input for each (optional)
- [ ] Answers saved (not required to continue)
- [ ] Previous week's answers viewable
- [ ] Collapsible section once completed
- [ ] No judgment messaging ("No need to be perfect")

### Files to Create/Modify
- `components/weekly/WeeklyReview.tsx`
- `lib/api/weeklyReviews.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Three prompts | Component | All three questions displayed |
| Text input | Manual | Can type answers |
| Optional save | Integration | Can continue without answering |
| Answers saved | Integration | Answers persist to database |
| View previous | Manual | Can see last week's answers |
| Collapsible | Manual | Section collapses when done |
| Tone check | Manual | No judgment messaging |

---

## TASK-042: Build Weekly Headings Selector

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-025, TASK-040

### Description
Allow users to set 1-3 focus areas for the week.

### Acceptance Criteria
- [ ] Section: "What will you focus on this week?"
- [ ] List existing Weekly Headings
- [ ] Add new heading (title input)
- [ ] Remove heading
- [ ] Max 3 enforced with helpful message
- [ ] Suggestions from Monthly Missions
- [ ] Headings link to relevant goals visually

### Files to Create/Modify
- `components/weekly/WeeklyHeadingsSelector.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Prompt shown | Component | "What will you focus on?" visible |
| List headings | Component | Existing headings displayed |
| Add heading | Manual | Can add new heading |
| Remove heading | Manual | Can remove heading |
| Max 3 | Component | Can't add 4th, message shown |
| Suggestions | Component | Monthly Missions suggested |
| Goal link visual | Component | Shows linked goal |

---

## TASK-043: Build "Populate This Week" Interface

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-040, TASK-026

### Description
Help users select tasks for the upcoming week.

### Acceptance Criteria
- [ ] Section: "Tasks for This Week"
- [ ] Pull from:
  - Horizon (inbox)
  - Leftover from previous week
  - Suggested from Monthly Missions
- [ ] Multi-select interface
- [ ] "Move to This Week" bulk action
- [ ] Preview of This Week column (current tasks)
- [ ] Soft limit warning if >7 tasks

### Files to Create/Modify
- `components/weekly/PopulateThisWeek.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Section title | Component | "Tasks for This Week" visible |
| Pull from Horizon | Component | Horizon tasks listed |
| Pull from leftover | Component | Previous week incomplete shown |
| Pull from Missions | Component | Mission-related tasks suggested |
| Multi-select | Manual | Can select multiple tasks |
| Bulk move | Manual | "Move to This Week" moves all |
| Preview | Component | Current This Week tasks shown |
| Soft limit | Component | Warning if >7 tasks |

---

# Phase 8: Settings and Polish

## Phase 8 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| Settings screen | Component | All sections render |
| Notifications | Integration | Permission request, scheduling |
| Empty states | Component | All screens have empty states |
| Error handling | Integration | Offline indicator, retry |
| Loading states | Component | Skeletons display correctly |

> **Goal:** Build settings screen and polish the overall experience.

---

## TASK-044: Build Settings Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Medium  
**Dependencies:** TASK-010

### Description
Create the settings screen with user preferences and account options.

### Acceptance Criteria
- [ ] Accessible from tab bar or profile icon
- [ ] Sections:
  - Account (email, sign out)
  - Preferences (notifications, sounds)
  - About (version, privacy policy, terms)
  - Support (feedback link)
- [ ] Sign out button with confirmation
- [ ] Delete account option (required for App Store)

### Files to Create/Modify
- `app/settings/index.tsx`
- `components/settings/SettingsSection.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| All sections | Component | Account, Preferences, About, Support visible |
| Email shown | Component | User's email displayed |
| Sign out | E2E | Confirmation, then redirect to login |
| Delete account | Manual | Confirmation, account deleted |
| Version shown | Component | App version displayed |
| Links work | Manual | Privacy, terms open in browser |
| Feedback link | Manual | Opens email or form |

---

## TASK-045: Implement Push Notifications Setup

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** Medium  
**Dependencies:** TASK-044

### Description
Set up push notification permissions and evening planning reminder.

### Acceptance Criteria
- [ ] `expo-notifications` configured
- [ ] Permission request on onboarding (with explanation)
- [ ] Evening reminder notification (default 8pm)
  - "Time to plan tomorrow. What's your True Step?"
- [ ] User can change reminder time in settings
- [ ] User can disable notifications
- [ ] Deep link: notification opens Today's Bearing or Kanban

### Files to Create/Modify
- `lib/notifications.ts`
- `app/settings/notifications.tsx`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Permission request | Manual | Dialog shown on onboarding |
| Explanation shown | Manual | Why we need permission |
| Evening reminder | Manual | Notification fires at 8pm |
| Custom time | Manual | Can change reminder time |
| Disable option | Manual | Can turn off notifications |
| Deep link | Manual | Tap notification opens app |
| Denied handling | Manual | Graceful handling if denied |

---

## TASK-046: Build Empty States for All Screens

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Medium  
**Dependencies:** All screen tasks

### Description
Create helpful empty states for when users have no data.

### Acceptance Criteria
- [ ] Today's Bearing: "No tasks planned. Evening planning sets you up for success."
- [ ] Kanban columns: Gentle prompts to add tasks
- [ ] Polaris: "Start by defining your North Stars"
- [ ] Weekly: "Ready for a fresh week?"
- [ ] All empty states include action button
- [ ] Illustrations or icons where appropriate
- [ ] Messaging is calm, never guilt-inducing

### Files to Create/Modify
- `components/common/EmptyState.tsx`
- Various screen files

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Today empty | Component | "No tasks planned" message |
| Kanban empty | Component | Each column has empty prompt |
| Polaris empty | Component | "Start by defining..." message |
| Weekly empty | Component | "Ready for fresh week?" message |
| Action button | Component | Each empty state has CTA |
| Illustrations | Manual | Icons/images look good |
| Tone | Manual | Calm, never guilt-inducing |

---

## TASK-047: Implement Error Handling and Offline Indicator

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-008

### Description
Add global error handling and offline status indicator.

### Acceptance Criteria
- [ ] Network status detected (online/offline)
- [ ] Offline indicator shown in header when offline
- [ ] Actions queue for sync when back online
- [ ] Error toast/alert for failed operations
- [ ] Retry option for failed requests
- [ ] Graceful degradation (read cache, defer writes)

### Files to Create/Modify
- `components/common/OfflineIndicator.tsx`
- `components/common/ErrorToast.tsx`
- `lib/api/queryClient.ts`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Offline detection | Manual | Turn off WiFi, indicator appears |
| Online detection | Manual | Turn on WiFi, indicator disappears |
| Queue actions | Manual | Actions work offline, sync later |
| Error toast | Manual | Failed request shows toast |
| Retry option | Manual | Can retry failed request |
| Cache fallback | Manual | Shows cached data when offline |
| Sync on reconnect | Manual | Queued actions sync when online |

---

## TASK-048: Add Loading States and Skeletons

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** Medium  
**Dependencies:** All screen tasks

### Description
Add loading skeletons and states throughout the app.

### Acceptance Criteria
- [ ] Skeleton screens for:
  - Today's Bearing (card placeholders)
  - Kanban (column placeholders)
  - Polaris (list placeholders)
- [ ] Pull-to-refresh indicator on all list screens
- [ ] Button loading states (spinner replaces text)
- [ ] Smooth transitions between loading and loaded

### Files to Create/Modify
- `components/ui/Skeleton.tsx`
- Various screen files

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Today skeleton | Component | Card placeholders during load |
| Kanban skeleton | Component | Column placeholders during load |
| Polaris skeleton | Component | List placeholders during load |
| Pull refresh | Manual | Spinner visible on pull |
| Button loading | Component | Spinner replaces button text |
| Transitions | Manual | Smooth fade from skeleton to content |
| Fast connection | Manual | Skeletons flash briefly (not jarring) |

---

## TASK-048B: Set Up E2E Testing with Maestro

**Status:** `[ ]` To Do  
**Estimate:** L  
**Priority:** Medium  
**Dependencies:** TASK-032, TASK-026

### Description
Set up Maestro for end-to-end testing of critical user flows.

### Acceptance Criteria
- [ ] Maestro CLI installed
- [ ] Test flows created for:
  - Signup → Onboarding → First goal
  - Login → View Today's Bearing
  - Create task → Move to Today → Focus Mode → Complete
  - Weekly planning flow
- [ ] Tests run against iOS Simulator
- [ ] Tests can run in CI (optional for MVP)

### Setup Commands
```bash
# Install Maestro
curl -Ls "https://get.maestro.mobile.dev" | bash

# Run tests
maestro test .maestro/
```

### Files to Create/Modify
- `.maestro/signup-flow.yaml`
- `.maestro/daily-flow.yaml`
- `.maestro/kanban-flow.yaml`
- `.maestro/weekly-flow.yaml`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Maestro runs | Manual | `maestro test` executes |
| Signup flow | E2E | New user completes onboarding |
| Daily flow | E2E | User completes True Step |
| Kanban flow | E2E | User creates and moves task |
| All pass | Manual | All E2E tests green |

---

# Phase 9: App Store Preparation

## Phase 9 Test Summary

| Test Suite | Type | Coverage |
|------------|------|----------|
| App icons | Manual | All sizes render correctly |
| Splash screen | Manual | Displays on launch |
| EAS build | Manual | Build succeeds, installs on device |
| TestFlight | Manual | Build uploads, installs via TF |
| Full E2E | E2E | Complete user journey on TF build |

> **Goal:** Prepare the app for TestFlight and App Store submission.

---

## TASK-049: Create App Icons and Splash Screen

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** None

### Description
Design and implement app icon and splash screen.

### Acceptance Criteria
- [ ] App icon designed (compass/north star theme)
- [ ] Icon in all required sizes (1024x1024 master)
- [ ] Splash screen with logo
- [ ] Splash screen uses brand colors
- [ ] `app.json` configured with icon and splash
- [ ] Icons look good on both light and dark home screens

### Files to Create/Modify
- `assets/icon.png`
- `assets/splash.png`
- `assets/adaptive-icon.png` (Android)
- `app.json`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Icon on home | Manual | Icon looks good on home screen |
| Icon sizes | Manual | All required sizes generated |
| Splash displays | Manual | Splash shows on cold start |
| Brand colors | Manual | Splash uses brand colors |
| Light home screen | Manual | Icon visible on light background |
| Dark home screen | Manual | Icon visible on dark background |

---

## TASK-050: Configure EAS Build

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** All development tasks

### Description
Set up Expo Application Services (EAS) for building the app.

### Acceptance Criteria
- [ ] `eas.json` created with build profiles:
  - Development (for testing)
  - Preview (TestFlight)
  - Production (App Store)
- [ ] iOS bundle identifier set
- [ ] App version and build number configured
- [ ] EAS CLI logged in
- [ ] Test build succeeds locally

### Files to Create/Modify
- `eas.json`
- `app.json`

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Dev build | Manual | `eas build --profile development` succeeds |
| Preview build | Manual | `eas build --profile preview` succeeds |
| Bundle ID | Manual | Correct bundle ID in build |
| Version number | Manual | Correct version in built app |
| Install on device | Manual | Built IPA installs on iPhone |
| Run without errors | Manual | App functions after install |

---

## TASK-051: Create Privacy Policy and Terms

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** None

### Description
Create required legal documents for App Store submission.

### Acceptance Criteria
- [ ] Privacy Policy document created
  - What data is collected
  - How it's used
  - Third-party services (Supabase)
  - User rights
- [ ] Terms of Service document
- [ ] Documents hosted at accessible URLs
- [ ] Links added to signup screen and settings

### Files to Create/Modify
- Legal documents (hosted externally or in app)
- Settings screen links

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Privacy policy | Manual | Document covers all data |
| Terms of service | Manual | Document is complete |
| URLs accessible | Manual | Links load in browser |
| Signup links | Manual | Links visible on signup |
| Settings links | Manual | Links visible in settings |
| Legal review | Manual | (Optional) Legal review done |

---

## TASK-052: Prepare App Store Metadata

**Status:** `[ ]` To Do  
**Estimate:** M  
**Priority:** High  
**Dependencies:** TASK-049

### Description
Prepare all metadata required for App Store submission.

### Acceptance Criteria
- [ ] App name: TrueNorth
- [ ] Subtitle: Direction-first productivity
- [ ] Description (short and long versions)
- [ ] Keywords for ASO
- [ ] Category: Productivity
- [ ] Age rating questionnaire completed
- [ ] Screenshots for iPhone 6.5" and 5.5" displays
- [ ] Optional: App preview video

### Files to Create/Modify
- App Store Connect (external)
- Screenshot assets

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| App name | Manual | "TrueNorth" in App Store Connect |
| Description | Manual | Compelling, accurate description |
| Keywords | Manual | Relevant keywords set |
| Category | Manual | Productivity category selected |
| Screenshots 6.5" | Manual | iPhone 14 Pro Max screenshots |
| Screenshots 5.5" | Manual | iPhone 8 Plus screenshots |
| Age rating | Manual | Questionnaire completed |
| Preview video | Manual | (Optional) Video uploaded |

---

## TASK-053: Submit TestFlight Build

**Status:** `[ ]` To Do  
**Estimate:** S  
**Priority:** High  
**Dependencies:** TASK-050, TASK-051

### Description
Build and submit the first TestFlight build for testing.

### Acceptance Criteria
- [ ] Production build created with EAS
- [ ] Build uploaded to App Store Connect
- [ ] TestFlight review submitted
- [ ] Internal testers invited
- [ ] Test notes provided
- [ ] Critical path tested on TestFlight build

### Files to Create/Modify
- None (external process)

### Test Plan
| Test | Type | Description |
|------|------|-------------|
| Build uploads | Manual | EAS submits to App Store Connect |
| Processing | Manual | Build processes without errors |
| TestFlight review | Manual | Build passes TF review |
| Internal testers | Manual | Testers receive invite |
| Install via TF | Manual | App installs from TestFlight |
| Critical path | E2E | Full user journey works on TF |
| Crash-free | Manual | No crashes during testing |

---

# Backlog (Post-MVP)

> These tasks are out of scope for MVP but documented for future consideration.

## BACKLOG-001: iCloud Sync Option
Alternative sync method for users who prefer Apple ecosystem.

## BACKLOG-002: Calendar Integration
Read-only view of calendar events to inform planning.

## BACKLOG-003: Templates
Pre-made North Stars, goals, and task templates.

## BACKLOG-004: Widgets
iOS home screen widget showing True Step.

## BACKLOG-005: Apple Watch App
View Today's Bearing and True Step on watch.

## BACKLOG-006: Analytics Dashboard
Personal productivity insights over time.

## BACKLOG-007: Android Release
Build and release on Google Play Store.

---

# Task Dependency Graph

```
Phase 0 (Foundation)
├── TASK-001 (Expo) ─┬── TASK-002 (Router)
│                    ├── TASK-003 (NativeWind)
│                    ├── TASK-004 (Structure)
│                    └── TASK-005 (Dependencies)
│                              └── TASK-006 (Supabase)
│                                        └── TASK-007 (Schema)
│                                        └── TASK-008 (React Query)
│
Phase 1 (Auth)
├── TASK-010 (Auth Guard) ── TASK-011 (Login) ── TASK-013 (Email Auth)
│                        └── TASK-012 (Signup)    ├── TASK-014 (Apple)
│                                                 └── TASK-015 (Google)
│
Phase 2 (Onboarding)
├── TASK-017 (Flow) ── TASK-018 (Welcome)
│                   └── TASK-019 (North Stars) ── TASK-020 (First Goal)
│
Phase 3-7 (Features) ── Can be parallelized after Phase 1
│
Phase 8-9 (Polish & Release)
```

---

# How to Use This Backlog

1. **Starting a task:** Change status to `[~]` In Progress
2. **Completing a task:** Change status to `[x]` Done
3. **Blocked:** Change status to `[-]` Blocked and add note
4. **Adding tasks:** Insert with next available TASK-XXX number
5. **Sprint planning:** Pull tasks by phase, respect dependencies

---

*Generated: 2026-02-07 | TrueNorth Project*
